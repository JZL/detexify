/*
 * Gritter for jQuery
 * http://www.boedesign.com/
 *
 * Copyright (c) 2009 Jordan Boesch
 * Dual licensed under the MIT and GPL licenses.
 *
 * Date: December 1, 2009
 * Version: 1.6
 */
!function(e){e.gritter={},e.gritter.options={fade_in_speed:"medium",fade_out_speed:1e3,time:6e3},e.gritter.add=function(e){try{return t.add(e||{})}catch(i){var r="Gritter Error: "+i;"undefined"!=typeof console&&console.error?console.error(r,e):alert(r)}},e.gritter.remove=function(e,i){t.removeSpecific(e,i||{})},e.gritter.removeAll=function(e){t.stop(e||{})};var t={fade_in_speed:"",fade_out_speed:"",time:"",_custom_timer:0,_item_count:0,_is_setup:0,_tpl_close:'<div class="gritter-close"></div>',_tpl_item:'<div id="gritter-item-[[number]]" class="gritter-item-wrapper [[item_class]]" style="display:none"><div class="gritter-top"></div><div class="gritter-item">[[image]]<div class="[[class_name]]"><span class="gritter-title">[[username]]</span><p>[[text]]</p></div><div style="clear:both"></div></div><div class="gritter-bottom"></div></div>',_tpl_wrap:'<div id="gritter-notice-wrapper"></div>',add:function(i){if(!i.title||!i.text)throw'You need to fill out the first 2 params: "title" and "text"';this._is_setup||this._runSetup();var r=i.title,o=i.text,n=i.image||"",s=i.sticky||!1,a=i.class_name||"",_=i.time||"";this._verifyWrapper(),this._item_count++;var c=this._item_count,p=this._tpl_item;e(["before_open","after_open","before_close","after_close"]).each(function(r,o){t["_"+o+"_"+c]=e.isFunction(i[o])?i[o]:function(){}}),this._custom_timer=0,_&&(this._custom_timer=_);var f=""!=n?'<img src="'+n+'" class="gritter-image" />':"",d=""!=n?"gritter-with-image":"gritter-without-image";p=this._str_replace(["[[username]]","[[text]]","[[image]]","[[number]]","[[class_name]]","[[item_class]]"],[r,o,f,this._item_count,d,a],p),this["_before_open_"+c](),e("#gritter-notice-wrapper").append(p);var u=e("#gritter-item-"+this._item_count);return u.fadeIn(this.fade_in_speed,function(){t["_after_open_"+c](e(this))}),s||this._setFadeTimer(u,c),e(u).bind("mouseenter mouseleave",function(i){"mouseenter"==i.type?s||t._restoreItemIfFading(e(this),c):s||t._setFadeTimer(e(this),c),t._hoverState(e(this),i.type)}),c},_countRemoveWrapper:function(t,i){i.remove(),this["_after_close_"+t](i),0==e(".gritter-item-wrapper").length&&e("#gritter-notice-wrapper").remove()},_fade:function(e,i,r,o){var r=r||{},n="undefined"!=typeof r.fade?r.fade:!0;fade_out_speed=r.speed||this.fade_out_speed,this["_before_close_"+i](e),o&&e.unbind("mouseenter mouseleave"),n?e.animate({opacity:0},fade_out_speed,function(){e.animate({height:0},300,function(){t._countRemoveWrapper(i,e)})}):this._countRemoveWrapper(i,e)},_hoverState:function(e,i){if("mouseenter"==i){e.addClass("hover");var r=e.find("img");r.length?r.before(this._tpl_close):e.find("span").before(this._tpl_close),e.find(".gritter-close").click(function(){var i=e.attr("id").split("-")[2];t.removeSpecific(i,{},e,!0)})}else e.removeClass("hover"),e.find(".gritter-close").remove()},removeSpecific:function(t,i,r,o){if(!r)var r=e("#gritter-item-"+t);this._fade(r,t,i||{},o)},_restoreItemIfFading:function(e,t){clearTimeout(this["_int_id_"+t]),e.stop().css({opacity:""})},_runSetup:function(){for(opt in e.gritter.options)this[opt]=e.gritter.options[opt];this._is_setup=1},_setFadeTimer:function(e,i){var r=this._custom_timer?this._custom_timer:this.time;this["_int_id_"+i]=setTimeout(function(){t._fade(e,i)},r)},stop:function(t){var i=e.isFunction(t.before_close)?t.before_close:function(){},r=e.isFunction(t.after_close)?t.after_close:function(){},o=e("#gritter-notice-wrapper");i(o),o.fadeOut(function(){e(this).remove(),r()})},_str_replace:function(e,t,i,r){var o=0,n=0,s="",a="",_=0,c=0,p=[].concat(e),f=[].concat(t),d=i,u=f instanceof Array,m=d instanceof Array;for(d=[].concat(d),r&&(this.window[r]=0),o=0,_=d.length;_>o;o++)if(""!==d[o])for(n=0,c=p.length;c>n;n++)s=d[o]+"",a=u?void 0!==f[n]?f[n]:"":f[0],d[o]=s.split(p[n]).join(a),r&&d[o]!==s&&(this.window[r]+=(s.length-d[o].length)/p[n].length);return m?d:d[0]},_verifyWrapper:function(){0==e("#gritter-notice-wrapper").length&&e("body").append(this._tpl_wrap)}}}(jQuery);